<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragment/heade :: head(petApet)}">
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<th:block th:replace="~{fragment/header :: header}"></th:block>

<!-- Search Start -->
<div class="container-fluid p-0">
    <div id="header-search" class="carousel slide">
        <div class="search-item active">
            <img class="w-100" src="img/carousel-0.jpg" alt="Image">
            <div class="search-caption">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <h1 class="display-1 text-white mb-5 animated slideInDown">Welcome petApet</h1>
                            <form class="d-flex" th:action="@{/search}">
                                <input class="form-control me-sm-2" name="searchContent" type="text"
                                       placeholder="찾고싶은 상품을 검색해 보세요!">
                                <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Search End -->

<!-- CommunityList Start -->
<div class="container-fluid top-feature py-5 pt-lg-0">
    <div class="container py-5 pt-lg-0">
        <div class="community row gx-0">
            <div class="col-lg-4 wow fadeIn" data-wow-delay="0.1s">
                <div class="bg-white shadow px-5 py-4" style="height: 240px;">
                    <h4 class="mb-0 pb-2 border-bottom border-3">
                        <span class="badge px-0 bg-light rounded-circle me-1" style="width:45px; height:45px;">
                            <i class="fa fa-check fs-2 text-primary"></i>
                        </span>
                        최신글
                    </h4>
                    <div class="mb-0 mt-3 table">
                        <ul id="latestList" class="m-0 p-0"></ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 wow fadeIn" data-wow-delay="0.3s">
                <div class="bg-white shadow px-5 py-4" style="height: 240px;">
                    <h4 class="mb-0 pb-2 border-bottom border-3">
                        <span class="badge px-0 bg-light rounded-circle me-1" style="width:45px; height:45px;">
                            <i class="bi bi-fire fs-2 text-primary"></i>
                        </span>
                        인기글
                    </h4>
                    <div class="mb-0 mt-3 table">
                        <ul id="popularList" class="m-0 p-0"></ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 wow fadeIn" data-wow-delay="0.5s">
                <div class="bg-white shadow px-5 py-4" style="height: 240px;">
                    <h4 class="mb-0 pb-2 border-bottom border-3">
                        <span class="badge px-0 bg-light rounded-circle me-1" style="width:45px; height:45px;">
                            <i class="bi bi-megaphone-fill me-1 fs-3 text-primary"></i>
                        </span>
                        공지사항
                    </h4>
                    <div class="mb-0 mt-3 table">
                        <ul id="noticeList" class="m-0 p-0"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- CommunityList End -->

<!--<div-->
<!--        id="kakao-talk-channel-chat-button"-->
<!--        data-channel-public-id="_txnxixbxj"-->
<!--        data-title="consult"-->
<!--        data-size="small"-->
<!--        data-color="mono"-->
<!--        data-shape="pc"-->
<!--        data-support-multiple-densities="true"-->
<!--        style="position: fixed; top: 53rem"-->
<!--&gt;</div>-->

<!-- Projects Start -->
<div class="container-xxl py-5">
    <div class="container">
        <div class="text-center mx-auto wow fadeInUp" data-wow-delay="0.1s" style="max-width: 500px;">
            <p class="fs-5 fw-bold text-primary">Product</p>
            <h1 class="display-5 mb-5">Best Product</h1>
        </div>
        <div class="row wow fadeInUp" data-wow-delay="0.3s">
            <div class="col-12 text-center">
                <ul class="list-inline rounded mb-5" id="portfolio-flters">
                    <li class="mx-2 active" onclick="sortProduct('productViewCount')">HOT</li>
                    <li class="mx-2" onclick="sortProduct('productId')">최근 등록상품</li>
                    <li class="mx-2" onclick="sortProduct('productSellCount')">판매순</li>
                    <li class="mx-2" onclick="sortProduct('review')">리뷰순</li>
                    <li class="mx-2" onclick="sortProduct('productRating')">별점순</li>
                    <li class="mx-2"><a th:href="|@{/product}|">상품목록으로→</a></li>
                </ul>
            </div>
        </div>
        <div class="row g-4" id="appendTarget">
            <div class="col-lg-3 col-md-6 portfolio-item first wow fadeInUp" data-wow-delay="0.1s">
                <div class="portfolio rounded">
                    <img class="" src="/product/images/e234fd85-0585-497a-a27a-4da3b5506929.png" width="300"
                         height="300" alt="">
                    <div class="portfolio-text" style="opacity: 1;">
                        <h1 class="text-start rounded ms-2">
                            <a style="text-decoration: none;" class="text-dark fs-5" href="/product/food/106/details">123</a>
                        </h1>
                        <div class="d-flex flex-row">
                            <div>
                                <fieldset class="p-1 col">
                                    <div class="d-flex flex-row" style="max-height: 1rem; margin-top: 0.1rem">
                                        <p class="star" value="0" id="star0">
                                            <a class="my_star" value="1">★</a>
                                            <a class="my_star" value="2">★</a>
                                            <a class="my_star" value="3">★</a>
                                            <a class="my_star" value="4">★</a>
                                            <a class="my_star" value="5">★</a>
                                        </p>
                                        <p>
                                        </p></div>
                                </fieldset>
                            </div>
                            <h6 class="align-self-center mt-2">(0)</h6>
                        </div>
                        <div class="d-flex flex-column">
                            <div class="col">
                                <h1 class="fs-6 text-end">123</h1>
                            </div>
                            <div class="d-flex flex-row">
                                <div class="d-flex flex-fill justify-content-sm-end btn-group-sm">
                                    <button type="button" class="btn bg-secondary me-1 addCart" value="106">장바구니
                                        <input type="hidden" class="quan" value="1"></button>
                                    <a class="btn bg-secondary me-1 addBuy" href="/direct/checkout/106">바로구매
                                        <input type="hidden" class="quan" value="1"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Projects End -->

<!-- About Start -->
<div class="container-xxl py-5">
    <div class="container">
        <div class="row g-5 align-items-end">
            <div class="col-lg-3 col-md-5 wow fadeInUp" data-wow-delay="0.1s">
                <img class="img-fluid rounded" data-wow-delay="0.1s" src="img/placeinfo.jpg">
            </div>
            <div class="col-lg-6 col-md-7 wow fadeInUp" data-wow-delay="0.3s">
                <h1 class="display-4 text-primary mb-0">이달의 추천 플레이스</h1>
                <h1 class="display-6 mb-4">Poison PetCafe</h1>
                <p class="mb-4">서울 근교에서 가장 가까운 애견카페
                    'Poison PetCafe' 입니다.
                    고양시 덕양구 이케아 인근에 위치해 있으며,
                    반려인을 위한 도심 속 힐링 반려견동반 카페 겸 반려견호텔&유치원을 별도로 운영하고 있습니다.
                    약 250평의 애견 운동장이 있으며, 약 50평의 애견 호텔 및 유치원 전용 운동장이 분리되어 있습니다.
                    애견 운동장은 정원수로 가꾸어져 안락한 휴식 공간을 제공합니다. 반려견 아이들의 케어는 자격증을 취득한 전문 훈련사가 관리하며, 정식 영업 신고된 애견 호텔은 최대 20마리 수용가능합니다.</p>
                <a class="btn btn-primary py-3 px-4">Link</a>
            </div>
            <div class="col-lg-3 col-md-12 wow fadeInUp" data-wow-delay="0.5s">
                <div class="row g-5">
                    <div class="col-12 col-sm-6 col-lg-12">
                        <div class="border-start ps-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="46" height="46" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16" style="color: #78C2AD">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                            </svg>
                            <h4 class="row mb-3">업체 정보</h4>
                            <span class="row">경기 고양시 덕양구 1층</span>
                            <span class="row">0000-0000-0000</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- About End -->

<!-- Back to Top -->
<a href="#" class="btn btn-lg btn-dark btn-lg-square rounded-circle back-to-top"><i class="bi bi-arrow-up"></i></a>

<th:block th:replace="~{fragment/layout :: mainFooter}"></th:block>

<!-- JavaScript Libraries -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="lib/wow/wow.min.js"></script>
<script src="lib/easing/easing.min.js"></script>
<script src="lib/waypoints/waypoints.min.js"></script>
<script src="lib/owlcarousel/owl.carousel.min.js"></script>
<script src="lib/counterup/counterup.min.js"></script>
<script src="lib/parallax/parallax.min.js"></script>
<script src="lib/isotope/isotope.pkgd.min.js"></script>
<script src="lib/lightbox/js/lightbox.min.js"></script>

<!-- Template Javascript -->
<script src="js/main.js"></script>

<script type="text/javascript" th:inline="javascript">
    // window.kakaoAsyncInit = function () {
    //     Kakao.Channel.createChatButton({
    //         container: '#kakao-talk-channel-chat-button',
    //     });
    // };

    // (function (d, s, id) {
    //     var js, fjs = d.getElementsByTagName(s)[0];
    //     if (d.getElementById(id)) return;
    //     js = d.createElement(s);
    //     js.id = id;
    //     js.src = 'https://t1.kakaocdn.net/kakao_js_sdk/2.0.0/kakao.channel.min.js';
    //     js.integrity = 'sha384-qN6njjEgLQzM0N/uuB26JXrlFnwdctF+owkJc/pTqUpi1Qrp9xAvRKYIkzH5XcJU';
    //     js.crossOrigin = 'anonymous';
    //     fjs.parentNode.insertBefore(js, fjs);
    // })(document, 'script', 'kakao-js-sdk');

    $(document).ready(sortProduct('productViewCount'));

    async function sortProduct(sortType) {
        $('#appendTarget').empty();
        fetch('/product/sort?sortType=' + sortType, {
            method: 'GET',
        })
            .then(response => {
                return response.json();
            })
            .then(data => {
                $.each(data, function (idx) {
                    const productListHtml = `
                <div class="col-lg-3 col-md-6 portfolio-item first wow fadeInUp" data-wow-delay="0.1s">
                <div class="portfolio rounded">
                    <img class="" src="/product/images/${data[idx].productImg.storeFileName}" width="300" height="300" alt="">
                    <div class="portfolio-text" style="opacity: 1;">
                        <h1 class="text-start rounded ms-2">
                            <a style="text-decoration: none;" class="text-dark fs-5" href="/product/food/${data[idx].productId}/details">${data[idx].productName}</a>
                        </h1>
                        <div class="d-flex flex-row">
                            <div>
                                <fieldset class="p-1 col">
                                    <div class="d-flex flex-row" style="max-height: 1rem; margin-top: 0.1rem">
                                        <p class="star" value="${data[idx].productRating}" id="star0">
                                            <a class="my_star" value="1">★</a>
                                            <a class="my_star" value="2">★</a>
                                            <a class="my_star" value="3">★</a>
                                            <a class="my_star" value="4">★</a>
                                            <a class="my_star" value="5">★</a>
                                        </p><p>
                                    </p></div>
                                </fieldset>
                            </div>
                            <h6 class="align-self-center mt-2">(${data[idx].productReview})</h6>
                        </div>
                        <div class="d-flex flex-column">
                            <div class="col">
                                <h1 class="fs-6 text-end" id="priceToString${idx}"></h1>
                            </div>
                            <div class="d-flex flex-row">
                                <div class="d-flex flex-fill justify-content-sm-end btn-group-sm">
                                    <button type="button" class="btn bg-secondary me-1 addCart" value="${data[idx].productId}" onclick="location.href='/product/food/${data[idx].productId}/details'">장바구니
                                        <input type="hidden" class="quan" value="1"></button>
                                    <a class="btn bg-secondary me-1 addBuy" href="/product/food/${data[idx].productId}/details">바로구매
                                        <input type="hidden" class="quan" name="quantity" value="1"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
                    var size = $('p[class = star]').length;
                    for (var i = 0; i < size; i++) {
                        $('p[class = star]').eq(i).attr('id', "moreRating" + i);

                        $("#moreRating" + i).find(".my_star").filter(function (k, v) {
                            return $(v).attr("value") <= $("#moreRating" + i).attr('value') ? $(v).addClass("on") : $(v).removeClass("on");
                        });
                    }
                    $('#appendTarget').append(productListHtml);
                    $('#priceToString' + idx).text(priceToString(data[idx].productPrice) + '원')
                })
            });
    }

    function priceToString(price) {
        return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    $(function () {
        getIndexCommunityList();
        // getPopularCommunityList();
    });
    getIndexCommunityList = function () {
        $.getJSON('/community/getIndexList', function (data) {
            showList(data.latest,"latest");
            showList(data.popular,"popular");
            showList(data.notice,"notice");
        })
    }

    showList = function (data, classification) {
        let str = ``
        if (data.content.length === 0) {
            str += `<li class="text-danger">작성된 글이 없습니다</li>`;
        } else {
            $.each(data.content, function (idx, val) {
                str += `<li class="text-truncate">
                        <span class="text-lightGray ps-0">${idx + 1}.</span>
                        <a href="/community/${val.communityId}" class="ps-0 text-dark">
                        <span class="text-danger me-2">${val.communityCategory}</span>`
                if (val.communitySubCategory != null) {
                    str += `<span class="text-lightGray me-2">${val.communitySubCategory}</span>`
                }
                str += `<span>${val.communityTitle}</span></a></li>`
            })
        }
        $(`#${classification}List`).html(str);
        // $('#' + classification + 'List').html(str);
    }

</script>
</body>

</html>